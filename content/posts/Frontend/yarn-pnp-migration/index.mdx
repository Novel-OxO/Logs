---
title: Next.js 16에서 Yarn PnP(Berry) 도입하며 겪은 트러블슈팅
date: 2026-01-25
category: Frontend
series: Next.js 블로그 구축기
description: Yarn Classic에서 Berry PnP로 전환하며 만난 Turbopack 호환성 문제와 GitHub 용량 제한으로 인한 Zero Installs 포기 과정을 공유합니다.
tags: ['Next.js', 'Yarn', 'PnP', 'Berry', 'Troubleshooting']
published: true
---

# 프로젝트의 격을 높이는 Yarn PnP 도입기

블로그 프로젝트를 진행하며 패키지 매니저를 **Yarn Classic(v1)**에서 **Yarn Berry(v4)**로 업그레이드했습니다. 단순히 버전만 올리는 것이 아니라, `node_modules`를 제거하고 **Plug'n'Play(PnP)**를 적용하여 더욱 효율적인 개발 환경을 구축하고자 했습니다.

당초 계획은 **Zero Installs**까지 적용하여 "클론 받자마자 실행되는 프로젝트"를 만드는 것이었으나, 예상치 못한 복병들을 만났습니다. 그 트러블슈팅 과정을 정리해 봅니다.

---

## 1. Yarn Berry & PnP 설정

먼저 `corepack`을 활성화하고 최신 Yarn 버전을 설정했습니다.

```bash
corepack enable
yarn set version stable
```

그리고 `.yarnrc.yml` 파일에서 `nodeLinker`를 `pnp`로 설정하여 `node_modules` 폴더와 작별을 고했습니다.

```yaml
# .yarnrc.yml
nodeLinker: pnp
```

## 2. 첫 번째 복병: Turbopack과 PnP의 불협화음

모든 설정이 순조로울 줄 알았으나, `yarn dev`를 실행하자마자 다음과 같은 에러가 발생했습니다.

```text
Error: Turbopack build failed with 1 errors:
./app
Error: Next.js inferred your workspace root, but it may not be correct.
We couldn't find the Next.js package (next/package.json) from the project directory...
```

### 원인 분석
Next.js 16의 새로운 번들러인 **Turbopack**이 아직 Yarn PnP 환경에서의 루트 감지 및 패키지 해상도 처리를 완벽하게 지원하지 못해 발생하는 이슈였습니다. 

### 해결책: 안정적인 Webpack으로 우회
Turbopack이 PnP를 정식 지원하기 전까지는 안정적인 **Webpack**으로 전환하기로 했습니다.

```json
"scripts": {
  "dev": "velite dev & next dev --webpack",
  "build": "velite build && next build --webpack"
}
```

## 3. 두 번째 복병: GitHub의 100MB 장벽 (Zero Installs 포기)

Zero Installs를 위해 `.yarn/cache` 내부의 zip 파일들을 커밋하려 했으나, **GitHub의 파일 크기 제한**에 걸리고 말았습니다.

- `next-npm-16.1.4.zip`: **135MB** (제한치 100MB 초과)

### 결정
Next.js와 같은 거대 패키지는 단일 압축 파일로도 100MB를 넘길 수 있습니다. Git LFS를 사용할 수도 있지만, 프로젝트의 복잡도를 낮추기 위해 **Zero Installs는 포기**하고 일반 PnP 환경만 유지하기로 결정했습니다.

`.yarnrc.yml` 설정을 다시 기본값으로 되돌리고, `.yarn/cache`는 다시 `.gitignore`에 추가했습니다.

```yaml
# .yarnrc.yml
enableGlobalCache: true
```

## 4. 툴링 연동

PnP 환경을 위해 IDE와 Git Hook 설정을 보완했습니다.

- **VSCode**: `yarn dlx @yarnpkg/sdks vscode`로 SDK 생성
- **Husky**: `npx` 대신 `yarn` 명령어로 브릿지 역할 수행

---

## 마치며

결국 Zero Installs는 포기했지만, **Yarn PnP** 도입만으로도 `node_modules`의 유령에서 벗어나 훨씬 깔끔한 프로젝트 구조를 갖게 되었습니다. 

Next.js와 Turbopack이 PnP를 완벽히 지원하고, 언젠가 GitHub의 용량 제한도 더 유연해진다면 다시 한번 Zero Installs에 도전해 보고 싶네요!
